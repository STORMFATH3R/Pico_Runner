pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- picorunner beta -stormfath3r
-- endless runner engine commented

-- initialization function.
    function _init()
        -- initialize main game update and draw functions.
        u, d = update_game, draw_game
    
        -- initialize platform pool, level settings, and player attributes.
        pool = {}
        lvl = {spd = 2, timer = 30, counter = 30}
        player = {
            x = 64, y = 64, vy = 0, g = 0.5, jmp = -6, is_jmp = false, 
            spr = 1, anim_counter = 0, anim_frame = 1, dt = 30
        }
    
        -- create the starting platform.
        create_plat(0, 96, 13, {14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14}, 15).active = true
    end
    
    -- main game update loop.
    function _update() 
        u() 
    end
    
    -- main game render loop.
    function _draw() 
        cls()  -- clear screen.
        d()  -- draw game.
    end
    
    -- update game logic.
    function update_game()
        -- decrement level counter and spawn platforms when needed.
        lvl.counter -= 1
        if lvl.counter <= 0 then 
            spawn() 
            lvl.counter = lvl.timer 
        end
    
        -- update each platform's position and check if they go off-screen.
        for _, p in pairs(pool) do
            if p.active then
                p.startx -= lvl.spd
                if p.startx + (#p.mid + 1) * 8 < 0 then 
                    p.active = false 
                end
            end
        end
        
        -- update player physics and check collisions.
        update_p()
        
        -- check player death.
        death()
    end
    
    -- update player movement and animations.
    function update_p()
        -- apply gravity to the player.
        player.vy += player.g
    
        -- handle player jumping.
        if (btn(❎) or btn(🅾️)) and not player.is_jmp then
            player.vy = player.jmp
            player.is_jmp = true
        end
        
        -- update player's vertical position.
        player.y += player.vy
    
        -- check collisions between player and platforms.
        for _, p in pairs(pool) do
            if p.active and player.y + 8 > p.starty and player.y < p.starty + 8 and player.x + 8 > p.startx and player.x < p.startx + (8 * (#p.mid + 2)) then
                player.y = p.starty - 8
                player.vy = 0
                if player.vy >= 0 then 
                    player.is_jmp = false 
                end
            end
        end
    
        -- handle player animations based on the state.
        if player.is_jmp then
            player.spr = 1
        else
            player.anim_counter = (player.anim_counter + 1) % 4
            if player.anim_counter == 0 then 
                player.spr = 3 - player.spr 
            end
        end    
    end
    
    -- draw game objects on the screen.
    function draw_game()
        -- draw each active platform.
        for _, p in pairs(pool) do
            if p.active then 
                draw_plat(p) 
            end
        end
        
        -- draw the player sprite.
        spr(player.spr, player.x, player.y)
        
        -- print game title and engine name on screen.
        print("stormfath3r's pico-8", 24, 8, 7)
        print("endless runner engine", 24, 16, 7)
    end
    
    -- draw individual platforms.
    function draw_plat(p)
        local x = p.startx
        spr(p.start, x, p.starty)
        for _, s in pairs(p.mid) do
            x += 8
            spr(s, x, p.starty)
        end
        spr(p.e, x + 8, p.starty)
    end
    
    -- create and initialize a platform.
    function create_plat(x, y, s, m, e)
        local p = get_plat()
        p.startx, p.starty, p.start, p.mid, p.e = x, y, s, m, e
        return p
    end
    
    -- get an inactive platform or create a new one.
    function get_plat()
        for _, p in pairs(pool) do
            if not p.active then 
                return p 
            end
        end
        local np = {startx = 128, starty = 96, mid = {}, start = 13, e = 15, active = false}
        add(pool, np)
        return np
    end
    
    -- create a random platform and add it to the pool.
    function spawn()
        local plat, mids, cnt = get_plat(), {}, flr(rnd(5)) + 1
        for i = 1, cnt do 
            add(mids, 14) 
        end
        create_plat(128, 64 + rnd(32), 13, mids, 15).active = true
    end
    
    -- handle player death.
    function death()
        if player.y > 128 then
            player.dt -= 1
            d = function() cls(2) print("you died", 48, 64, 7) print("press ❎ or 🅾️", 36, 72, 7) end
            if btn(❎) or btn(🅾️) and player.dt <= 0  then _init() end
        end
    end
    
__gfx__
00000000000000000006660000006660000066600000000000000000000000000000000000000000000000000000000000000000033333333333333333333330
00000000000666000066868000068680000686800000000000000000000000000000000000000000000000000000000000000000333333333333333333333333
00700700006686800006660000066660000666600000000000000000000000000000000000000000000000000000000000000000433443344334433443344334
00077000000666000006000000006600000066000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444
00077000000600000006600000066660000666600000000000000000000000000000000000000000000000000000000000000000444444444444444444444444
00700700000660000006600000deded000edede00000000000000000000000000000000000000000000000000000000000000000444444444444444444444444
0000000000066000000660000d55555d0e55555e0000000000000000000000000000000000000000000000000000000000000000444444444444444444444444
00000000006006000006600000deded000edede00000000000000000000000000000000000000000000000000000000000000000044444444444444444444440
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000007707770077077707770777077707770707077707770070007700000777077700770077000007770000000000000000000000000
00000000000000000000000070000700707070707770700070700700707000707070700070000000707007007000707000007070000000000000000000000000
00000000000000000000000077700700707077007070770077700700777007707700000077700000777007007000707077707770000000000000000000000000
00000000000000000000000000700700707070707070700070700700707000707070000000700000700007007000707000007070000000000000000000000000
00000000000000000000000077000700770070707070700070700700707077707070000077000000700077700770770000007770000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000077707700770070007770077007700000777070707700770077707770000077707700077077707700777000000000000000000000
00000000000000000000000070007070707070007000700070000000707070707070707070007070000070007070700007007070700000000000000000000000
00000000000000000000000077007070707070007700777077700000770070707070707077007700000077007070700007007070770000000000000000000000
00000000000000000000000070007070707070007000007000700000707070707070707070007070000070007070707007007070700000000000000000000000
00000000000000000000000077707070777077707770770077000000707007707070707077707070000077707070777077707070777000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006660000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000066868000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006660000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006600000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000006600000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000060060000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000033333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000333333333333333333333333333333333333333300000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000433443344334433443344334433443344334433400000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000444444444444444444444444444444444444444400000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000444444444444444444444444444444444444444400000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000444444444444444444444444444444444444444400000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000444444444444444444444444444444444444444400000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000044444444444444444444444444444444444444000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000033333333333333333333333333333333333
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000333333333333333333333333333333333333
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000433443344334433443344334433443344334
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444444444444444
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444444444444444
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444444444444444
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000444444444444444444444444444444444444
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044444444444444444444444444444444444
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
34433443344334433443340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__gff__
0000000000000000000000000080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
